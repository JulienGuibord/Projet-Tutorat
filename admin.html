<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Administration Tuto+</title>
  <style>
    :root {
      --primary: #1976d2;
      --danger: #d32f2f;
      --success: #388e3c;
      --gray: #555;
    }
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
    }
    .container {
      max-width: 1000px;
      margin: 0 auto;
      background: white;
      overflow: hidden;
    }
    header {
      background: var(--primary);
      color: white;
      padding: 20px;
      text-align: center;
    }
    .tabs {
      display: flex;
      background: #eee;
      border-bottom: 1px solid #ddd;
    }
    .tab {
      padding: 15px 25px;
      cursor: pointer;
      font-weight: bold;
    }
    .tab.active { background: white; border-bottom: 3px solid var(--primary); }
    .content {
      padding: 30px;
      min-height: 500px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
    }
    th, td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }
    th { background: #f5f5f5; }
    button {
      padding: 8px 12px;
      border: none;
      cursor: pointer;
      font-weight: bold;
    }
    /* bouton */
    .btn-edit { background: #ff9800; color: white; }
    .btn-delete { background: var(--danger); color: white; }
    .btn-toggle { background: #607d8b; color: white; }
    .btn-add { background: var(--success); color: white; }
    .form-group {
      margin: 15px 0;
    }
    label { display: block; margin-bottom: 5px; font-weight: bold; }
    input, select {
      width: 100%;
      padding: 10px;
      border: 1px solid #ccc;
    }
    .hidden { display: none; }

  </style>
</head>
<body>

<div class="container">
  <header>
    <h1>Administration Tuto+</h1>
    <a href="#" class="logout" onclick="logout()">Déconnexion</a>
  </header>

  <div class="tabs">
    <div class="tab active" onclick="openTab('comptes')">Comptes utilisateurs</div>
    <div class="tab" onclick="openTab('rdv')">Rendez-vous</div>
  </div>

  <div class="content">

    <!-- Onglet Comptes -->
    <div id="comptes">
      <h2>Gestion des comptes</h2>
      <button class="btn-add" onclick="openAddModal()">+ Ajouter un compte</button>

      <table id="table-comptes">
        <thead>
          <tr>
            <th>ID</th>
            <th>Nom</th>
            <th>Prénom</th>
            <th>Rôle</th>
            <th>Statut</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- Onglet Rendez-vous -->
    <div id="rdv" class="hidden">
      <h2>Tous les rendez-vous</h2>
      <table id="table-rdv">
        <thead>
          <tr>
            <th>Étudiant</th>
            <th>Service</th>
            <th>Tuteur</th>
            <th>Date/Heure</th>
            <th>Statut</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>
</div>

<script>

const ADMIN_PASSWORD = "admin123";

if (localStorage.getItem("adminLogged") !== "true") {
  const pass = prompt("Mot de passe administrateur :");
  if (pass !== ADMIN_PASSWORD) {
    alert("Accès refusé !");
    window.location.href = "index.html";
  } else {
    localStorage.setItem("adminLogged", "true");
  }
}

function logout() {
  localStorage.removeItem("adminLogged");
  window.location.href = "index.html";
}

let comptes = JSON.parse(localStorage.getItem("comptes_tuto") || "[]");
let demandes = JSON.parse(localStorage.getItem("rendezvous") || "[]");

function saveComptes() {
  localStorage.setItem("comptes_tuto", JSON.stringify(comptes));
}
function saveRdv() {
  localStorage.setItem("rendezvous", JSON.stringify(demandes));
}

function openTab(tabName) {
  document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
  document.querySelectorAll(".content > div").forEach(c => c.classList.add("hidden"));
  document.querySelector(`.tab[onclick="openTab('${tabName}')"]`).classList.add("active");
  document.getElementById(tabName).classList.remove("hidden");

  if (tabName === "comptes") renderComptes();
  if (tabName === "rdv") renderRdv();
}

let editingId = null;

function renderComptes() {
  const tbody = document.querySelector("#table-comptes tbody");
  tbody.innerHTML = "";

  comptes.forEach(c => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${c.id}</td>
      <td>${c.nom}</td>
      <td>${c.prenom}</td>
      <td>${c.role === "tuteur" ? "Tuteur" : "Étudiant"}</td>
      <td class="${c.active ? "status-active" : "status-inactive"}">
        ${c.active ? "Actif" : "Inactif"}
      </td>
      <td>
        <button class="btn-edit" onclick="editCompte('${c.id}')">Modifier</button>
        <button class="btn-toggle" onclick="toggleCompte('${c.id}')">
          ${c.active ? "Désactiver" : "Activer"}
        </button>
        <button class="btn-delete" onclick="deleteCompte('${c.id}')">Supprimer</button>
      </td>
    `;
    tbody.appendChild(tr);
  });
}

// Fonction ajouter un compte
function openAddModal() {
}

// Fonction modifier un compte
function editCompte(id) {
  const c = comptes.find(x => x.id === id);
  if (!c) return;
  editingId = id;
  document.getElementById("modal-title").textContent = "Modifier le compte";
  document.getElementById("input-id").value = c.id;
  document.getElementById("input-id").disabled = true;
  document.getElementById("input-nom").value = c.nom;
  document.getElementById("input-prenom").value = c.prenom;
  document.getElementById("input-role").value = c.role;
  document.getElementById("modal").classList.remove("hidden");
}

function saveCompte() {
  const id = document.getElementById("input-id").value.trim();
  const nom = document.getElementById("input-nom").value.trim();
  const prenom = document.getElementById("input-prenom").value.trim();
  const role = document.getElementById("input-role").value;

  if (!id || !nom || !prenom) return alert("Tous les champs sont requis.");

  if (editingId) {
    const c = comptes.find(x => x.id === editingId);
    c.nom = nom;
    c.prenom = prenom;
    c.role = role;
  } else {
    if (comptes.some(x => x.id === id)) return alert("Cet ID existe déjà !");
    comptes.push({ id, nom, prenom, role, active: true });
  }

  saveComptes();
  closeModal();
  renderComptes();
}

function toggleCompte(id) {
  const c = comptes.find(x => x.id === id);
  if (c) {
    c.active = !c.active;
    saveComptes();
    renderComptes();
  }
}

// Supprimer un compte
function deleteCompte(id) {
  if (confirm("Supprimer ce compte définitivement ?")) {
    comptes = comptes.filter(x => x.id !== id);
    saveComptes();
    renderComptes();
  }
}

// === Gestion Rendez-vous ===
function renderRdv() {
  const tbody = document.querySelector("#table-rdv tbody");
  tbody.innerHTML = "";

  demandes.forEach((d, i) => {
    const statut = d.reponse === null ? "En attente" :
                   d.reponse === true ? "Accepté" : "Refusé";
    const couleur = d.reponse === null ? "#ff9800" :
                    d.reponse === true ? "green" : "red";

    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${d.etudiant}</td>
      <td>${d.service}</td>
      <td>${d.tuteur || "-"}</td>
      <td>${d.debut.replace(/ /g," à ")} → ${d.fin.split(" ")[1]}</td>
      <td style="color:${couleur};font-weight:bold;">${statut}</td>
      <td>
        <button class="btn-delete" onclick="deleteRdv(${i})">Supprimer</button>
      </td>
    `;
    tbody.appendChild(tr);
  });
}

// Supprimer un rendez-vous
function deleteRdv(index) {
  if (confirm("Supprimer ce rendez-vous ?")) {
    demandes.splice(index, 1);
    saveRdv();
    renderRdv();
  }
}

</script>

</body>
</html>